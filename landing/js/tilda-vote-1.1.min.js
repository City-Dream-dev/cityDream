function t_removeEl(el){el.parentNode&&el.parentNode.removeChild(el)}function t_triggerEvent(el,eventName){var event;"function"==typeof window.CustomEvent?event=new CustomEvent(eventName):document.createEvent?(event=document.createEvent("HTMLEvents")).initEvent(eventName,!0,!1):document.createEventObject&&((event=document.createEventObject()).eventType=eventName),event.eventName=eventName,el.dispatchEvent?el.dispatchEvent(event):el.fireEvent?el.fireEvent("on"+event.eventType,event):el[eventName]?el[eventName]():el["on"+eventName]&&el["on"+eventName]()}function tvote__init(recId){var allRecords;if(!document.getElementById("allrecords").getAttribute("data-tilda-mode")){var startDate=new Date,rec,vote=document.querySelector("#rec"+recId).querySelector(".t-vote"),fullID=tvote__makeFullVoteID(vote),opts={type:vote.getAttribute("data-vote-type"),voteID:fullID,voteEl:vote,voteVisibility:vote.getAttribute("data-vote-visibility"),startDate:startDate};t_vote__checkVoteCondition(opts),"yes"!==vote.getAttribute("data-vote-finished")?setTimeout((function(){t_vote__initOneVote(opts)}),500):vote.classList.add("t-vote_sended")}}function tvote__makeFullVoteID(vote){vote instanceof Element||(vote=vote[0]);var voteID=vote.getAttribute("data-vote-id");if(voteID){var fullVoteID=document.querySelector("#allrecords").getAttribute("data-tilda-project-id")+voteID;return fullVoteID=fullVoteID.replace("&quot;","").replace("&#039;","").replace(/[&/\\#,+()$~%.'":;*?!<>{}\-_\s]/g,""),vote.setAttribute("data-vote-id",fullVoteID),fullVoteID}}function t_vote__checkVoteCondition(opts){var curVoteCookie=t_vote__getCookie("vote"+opts.voteID),curVoteResult=t_vote__getCookie("voteresult"+opts.voteID);if("yes"===opts.voteVisibility||"onclick"===opts.voteVisibility&&curVoteCookie){var btnsResult=opts.voteEl.querySelectorAll(".t-vote__btn-res");Array.prototype.forEach.call(btnsResult,(function(result){result.style.display="block"}))}curVoteCookie&&(opts.voteEl.classList.add("js-vote-sended"),opts.voteEl.classList.add("t-vote_sended")),"single"===opts.type&&curVoteCookie&&curVoteResult&&opts.voteEl.querySelector('[data-answer-id="'+curVoteResult+'"] .t-vote__btn-el').classList.add("t-vote__btn-el_active"),tvote__getResult(opts.voteID)}function t_vote__getCookie(name){var matches=document.cookie.match(new RegExp("(?:^|; )"+name.replace(/([.$?*|{}()[\]\\/+^])/g,"\\$1")+"=([^;]*)"));return matches?decodeURIComponent(matches[1]):void 0}function tvote__getResult(voteID){var vote=document.querySelector('[data-vote-id="'+voteID+'"]'),type=vote.getAttribute("data-vote-type");if("single"===type)var url="https://vote.tildacdn.com/vote/1/getresult/";if("multi"===type)var url="https://vote.tildacdn.com/vote/2/getresult/";if(type){var xhr=new XMLHttpRequest;url+="?voteid="+voteID+"&host="+location.protocol+"//"+location.host,xhr.open("GET",url,!0),xhr.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),xhr.onload=function(){if(xhr.status>=200&&xhr.status<400){var data=xhr.responseText;if(data){var objData=JSON.parse(data);if("object"==typeof objData)if(objData.error){var btnResult=vote.querySelectorAll(".t-vote__btn-res");Array.prototype.forEach.call(btnResult,(function(btn){btn.style.display="none"}))}else"single"===type&&Array.prototype.forEach.call(Object.keys(objData[0]),(function(key){var counter=vote.querySelector('[data-answer-id="'+key+'"] .js-vote-count');counter&&(counter.innerHTML=objData[0][key])})),"multi"===type&&(Array.prototype.forEach.call(Object.keys(objData[0]),(function(vid){var value=objData[0][vid],sum=0;Array.prototype.forEach.call(Object.keys(value),(function(aid){sum+=1*value[aid]})),Array.prototype.forEach.call(Object.keys(value),(function(aid){var val=value[aid],percentage=Math.round(100*val/sum),answerID=aid.slice(0,aid.indexOf("-")),answerEl=vote.querySelector('[data-question-id="'+vid+'"] [data-answer-id="'+answerID+'"]');if(answerEl){var counter=answerEl.querySelector(".js-vote-count"),percent=answerEl.querySelector(".js-vote-percent");counter&&(counter.innerHTML=val),percent&&(percent.innerHTML=percentage+"%")}}))})),setTimeout((function(){vote&&t_triggerEvent(vote,"tildavote:numberschanged")}),1e3));else t_vote__showError(voteID,"")}else t_vote__showError(voteID,"")}else t_vote__showError(voteID,"")},xhr.onerror=function(){console.log("Fatal error: "+xhr),t_vote__showError(voteID,"")},xhr.send()}}function t_vote__initOneVote(opts){var btns=opts.voteEl.querySelectorAll(".js-sendvote-btn");Array.prototype.forEach.call(btns,(function(btn){btn.addEventListener("click",(function(e){if(!opts.voteEl.classList.contains("js-vote-sending")){var sendVote=!0;"single"===opts.type&&(opts.answerID=btn.closest(".js-vote-item").getAttribute("data-answer-id"),opts.clickedEl=btn,opts.url="https://vote.tildacdn.com/vote/1/",sendVote=t_vote__handleClick_single(opts)),"multi"===opts.type&&(opts.url="https://vote.tildacdn.com/vote/2/",sendVote=t_vote__handleClick_multi(opts)),sendVote&&(t_vote__itemSend(opts),e.preventDefault())}}))}))}function t_vote__handleClick_single(opts){return!(!opts.clickedEl.classList.contains("t-vote__btn-el_active")&&opts.voteEl.classList.contains("js-vote-sended"))&&(!opts.clickedEl.classList.contains("t-vote__btn-el_active")||!opts.voteEl.classList.contains("js-vote-sended")||(t_vote__getCookie("vote_candelete"+opts.voteID)&&t_vote__itemDelete_single(opts),!1))}function t_vote__handleClick_multi(opts){var result=[],answeredVotes=opts.voteEl.querySelectorAll(".js-vote-question"),votesNum=opts.voteEl.querySelectorAll(".js-vote-question").length;return answeredVotes=Array.prototype.filter.call(answeredVotes,(function(answeredVote){if(answeredVote.querySelector(".js-vote-btn:checked"))return answeredVote})),!opts.voteEl.classList.contains("js-vote-sended")&&(answeredVotes.length!=votesNum?("RU"===window.tildaBrowserLang?t_vote__showError(opts.voteID,"Пожалуйста, ответьте на все вопросы."):t_vote__showError(opts.voteID,"Please, answer all questions."),!1):(Array.prototype.forEach.call(answeredVotes,(function(vote){var questionID=vote.getAttribute("data-question-id"),questionAnswers=vote.querySelectorAll(".js-vote-btn:checked"),questionResult=[];Array.prototype.forEach.call(questionAnswers,(function(answer){var answerId=answer.closest(".js-vote-item").getAttribute("data-answer-id");questionResult.push(answerId+"-"+questionID+"-"+opts.voteID)})),result.push({answer:questionResult,question:questionID})})),opts.answerArr=result,!0))}function t_vote__itemSend(opts){if(opts.seconds_fromStart=((new Date).getTime()-opts.startDate.getTime())/1e3,t_vote__changeVoteCondition(opts,"add"),opts.voteEl.classList.add("js-vote-sending"),opts.voteEl.classList.add("t-multivote_sended"),t_vote__addLoadingStyle(opts.voteEl),"onclick"===opts.voteVisibility){var btnsResult=opts.voteEl.querySelectorAll(".t-vote__btn-res");Array.prototype.forEach.call(btnsResult,(function(result){result.style.display="block"}))}var formData=new FormData,xhr=new XMLHttpRequest;formData.append("host",location.protocol+"//"+location.host),xhr.open("POST",opts.url+"init/",!0),xhr.onload=function(){if(xhr.status>=200&&xhr.status<400){var data=xhr.responseText;if(data){var objData=JSON.parse(data);"object"==typeof objData?(opts.sessionKey=objData.key,opts.sessionCookie=objData.session,opts.voteHash=opts.voteID+opts.sessionKey,t_vote__itemSend_continue(opts)):t_vote__showError(opts.voteID,"")}else t_vote__showError(opts.voteID,"")}else t_vote__showError(opts.voteID,"")},xhr.onerror=function(){console.log("Fatal error: "+xhr),t_vote__changeVoteCondition(opts,"remove"),t_vote__showError(opts.voteID,"")},xhr.send(formData)}function t_vote__itemSend_continue(opts,captchakey){var allRecords=document.querySelector("#allrecords"),pageID=allRecords.getAttribute("data-tilda-page-id"),projectID=allRecords.getAttribute("data-tilda-project-id"),sendData={hash:opts.voteHash,projectid:projectID,pageid:pageID,host:location.protocol+"//"+location.host,time:opts.seconds_fromStart,session:opts.sessionCookie};"single"===opts.type&&(sendData.voteid=opts.voteID,sendData.answerid=opts.answerID),"multi"===opts.type&&(sendData.multivoteid=opts.voteID,sendData.answers=opts.answerArr),captchakey&&(sendData.votecaptcha=captchakey,t_vote__changeVoteCondition(opts,"add")),sendData=t_vote__getObjParams(sendData);var formData=new FormData;Array.prototype.forEach.call(Object.keys(sendData),(function(key){formData.append(key,sendData[key])}));var xhr=new XMLHttpRequest;xhr.open("POST",opts.url+"send/",!0),xhr.onload=function(){if(xhr.status>=200&&xhr.status<400){var data=xhr.responseText;if(data){opts.voteEl.classList.remove("js-vote-sending"),opts.voteEl.classList.remove("t-vote_loading");var objData=JSON.parse(data);if("object"==typeof objData)if(objData.error)t_vote__changeVoteCondition(opts,"remove"),opts.voteEl.classList.remove("t-vote_sended"),t_vote__handleServerError(objData,opts);else{opts.voteEl.classList.add("js-vote-sended"),opts.voteEl.classList.add("t-vote_sended"),t_vote__writeSendCookie(objData,opts);var existingErrorEl=opts.voteEl.querySelector(".t-vote__errorbox");existingErrorEl&&t_removeEl(existingErrorEl),opts.voteEl&&t_triggerEvent(opts.voteEl,"tildavote:resultsended")}else t_vote__showError(opts.voteID,"")}else t_vote__showError(opts.voteID,"")}else t_vote__showError(opts.voteID,"")},xhr.onerror=function(){console.log("Fatal error: "+xhr),t_vote__showError(opts.voteID,"")},xhr.send(formData)}function t_vote__getObjParams(objData,strKey){var newObj={},strKey=strKey||"";return Array.prototype.forEach.call(Object.keys(objData),(function(key){var str;Array.isArray(objData[key])?Array.prototype.forEach.call(objData[key],(function(obj,ind){var str;obj instanceof Object?(strKey=key+"["+ind+"]",Object.assign(newObj,t_vote__getObjParams(obj,strKey)),strKey=""):newObj[strKey+"["+key+"][]"]=obj})):strKey?newObj[strKey+"["+key+"]"]=objData[key]:newObj[key]=objData[key]})),newObj}function t_vote__writeSendCookie(data,opts){"ok"===data.message&&(t_vote__setCookie("vote"+data.voteid,opts.voteHash,{expires:86400}),"single"===opts.type&&(t_vote__setCookie("voteresult"+data.voteid,opts.answerID,{expires:86400}),t_vote__setCookie("vote_candelete"+data.voteid,"yes",{expires:1800})))}function t_vote__itemDelete_single(opts){opts.seconds_fromStart=((new Date).getTime()-opts.startDate.getTime())/1e3,t_vote__changeVoteCondition(opts,"remove"),opts.voteEl.classList.add("js-vote-sending"),opts.voteEl.classList.remove("t-vote_sended"),t_vote__addLoadingStyle(opts.voteEl),opts.voteHash=t_vote__getCookie("vote"+opts.voteID);var sendData={voteid:opts.voteID,hash:opts.voteHash,host:location.protocol+"//"+location.host},formData=new FormData;Array.prototype.forEach.call(Object.keys(sendData),(function(key){formData.append(key,sendData[key])}));var xhr=new XMLHttpRequest;xhr.open("POST",opts.url+"delete/",!0),xhr.onload=function(){if(xhr.status>=200&&xhr.status<400){var data=xhr.responseText;if(data){opts.voteEl.classList.remove("js-vote-sending"),opts.voteEl.classList.remove("t-vote_loading");var objData=JSON.parse(data);"object"==typeof objData?objData.error?(t_vote__changeVoteCondition(opts,"add"),opts.voteEl.classList.add("t-vote_sended"),t_vote__handleServerError(objData,opts)):(opts.voteEl.classList.remove("js-vote-sended"),opts.voteEl.classList.remove("t-vote_sended"),t_vote__removeSendCookie(objData,opts)):t_vote__showError(opts.voteID,"")}else t_vote__showError(opts.voteID,"")}else t_vote__showError(opts.voteID,"")},xhr.onerror=function(){console.log("Fatal error: "+xhr),t_vote__showError(opts.voteID,"")},xhr.send(formData)}function t_vote__removeSendCookie(data,opts){if("ok"===data.message){var options={expires:1};t_vote__setCookie("vote"+data.voteid,opts.voteHash,options),t_vote__setCookie("voteresult"+data.voteid,"",options),t_vote__setCookie("vote_candelete"+data.voteid,"",options)}}function t_vote__addLoadingStyle(voteBlock){setTimeout((function(){voteBlock.classList.contains("js-vote-sending")&&voteBlock.classList.add("t-vote_loading")}),150)}function t_vote__handleServerError(data,opts){if(6==data.error)return window.tvote_opts=opts,void addTildaCaptcha();var errorText="";errorText="RU"===window.tildaBrowserLang?"Что-то пошло не так и голосование не может корректно работать. Пожалуйста, попробуйте другой браузер, отключите режим инкогнито или обратитесь к владельцу сайта.":"Something went wrong and vote doesn't work correctly. Please, try another browser, unlock private mode or write to website owner.",1==data.error&&(errorText="RU"===window.tildaBrowserLang?"С этого IP недавно голосовали. Пожалуйста, подождите 10 минут и попробуйте еще раз.":"Somebody has recently voted from this IP. Please wait 10 minutes and try again."),2==data.error&&(errorText="RU"===window.tildaBrowserLang?"С вашего IP адреса приходит слишком много запросов к серверу. Сервер временно не может принимать голоса с этого IP. Пожалуйста, попробуйте еще раз позже.":"There are too many votes from your IP. Server temporarily can't get votes from this IP. Please, try again later."),4==data.error&&(errorText="RU"===window.tildaBrowserLang?"Извините, но голос удалить уже нельзя. Удалить голос можно только в течение 30 минут после активации.":"Sorry, but you can't delete vote now. You can delete votes just during 30 minutes after activation."),5==data.error&&(errorText="RU"===window.tildaBrowserLang?"С вашего IP запросы приходят слишком часто. Пожалуйста, подождите 7 секунд прежде чем выбирать ответы в слудующих голосованиях на странице.":"Votes are sended too often from your IP. Please wait 7 seconds between choosing answers in different votes."),t_vote__showError(opts.voteID,errorText)}function addTildaCaptcha(){var voteCaptchaBox=document.querySelector("#tildavotecaptchabox");voteCaptchaBox&&t_removeEl(voteCaptchaBox),document.body.insertAdjacentHTML("beforebegin",'<div id="tildavotecaptchabox" style="z-index: 100000;position:fixed; text-align: center; vertical-align: middle; top: 0px; left:0px; bottom: 0px; right: 0px; background: rgba(255,255,255,0.97);"><iframe id="captchaIframeBox" src="https://vote.tildacdn.com/vote/1/send/showcaptcha.php" frameborder="0" width="100%" height="100%"></iframe></div>'),window.removeEventListener("message",checkVerifyTildaVoteCaptcha),window.addEventListener("message",checkVerifyTildaVoteCaptcha)}function checkVerifyTildaVoteCaptcha(event){var voteCaptchaBox=document.querySelector("#tildavotecaptchabox");if(-1!==event.origin.indexOf("vote.tildacdn.com")){if(voteCaptchaBox&&t_removeEl(voteCaptchaBox),"closeiframe"===event.data)return;t_vote__itemSend_continue(window.tvote_opts,event.data)}}function t_vote__showError(voteID,errorText){errorText||(errorText="RU"===window.tildaBrowserLang?"Что-то пошло не так и голосование может работать некорректно. Пожалуйста, проверьте соединение с интернетом или обратитесь к владельцу сайта.":"Something went wrong and vote doesn't work correctly. Please, check your internet connection or write to website owner.");var vote=document.querySelector('[data-vote-id="'+voteID+'"]'),type=vote.getAttribute("data-vote-type");if(!type||"single"===type){var errorEl="<div class='t-vote__errorbox'><div class='t-vote__errorbox-text t-text t-text_xs t-align_center' style='background-color:#333;color:#fff;padding:20px;margin-top:30px;'>"+errorText+"</div></div>";vote.insertAdjacentHTML("afterend",errorEl),vote.style.display="none"}if("multi"===type){var existingErrorEl=vote.querySelector(".t-vote__errorbox");existingErrorEl&&t_removeEl(existingErrorEl);var errorEl="<div class='t-vote__errorbox'><div class='t-vote__errorbox-text t-text t-text_xs t-align_center' style='background-color:#F95D51;color:#fff;padding:20px;margin:30px 0px;'>"+errorText+"</div></div>",btnsSendVote=vote.querySelectorAll(".js-sendvote-btn");btnsSendVote[btnsSendVote.length-1].insertAdjacentHTML("beforebegin",errorEl)}}function t_vote__changeVoteCondition(opts,action){var actionElement,actionElement;("multi"===opts.type&&t_vote__changeStat(opts,action),"single"===opts.type&&"add"===action)&&(t_vote__incrementAnswerNum(opts.voteID,opts.answerID),(actionElement=opts.voteEl.querySelector('[data-answer-id="'+opts.answerID+'"] .t-vote__btn-el')).classList.add("t-vote__btn-el_active"));"single"===opts.type&&"remove"===action&&(t_vote__decrementAnswerNum(opts.voteID,opts.answerID),(actionElement=opts.voteEl.querySelector(".t-vote__btn-el_active")).classList.remove("t-vote__btn-el_active"))}function t_vote__changeStat(opts,action){var questions=opts.voteEl.querySelectorAll(".js-vote-question");Array.prototype.forEach.call(questions,(function(question){var answers=question.querySelectorAll(".js-vote-item"),sum=0;Array.prototype.forEach.call(answers,(function(answer){var counter=answer.querySelector(".js-vote-count");if(counter){var amount=1*counter.textContent,checkedEl=answer.querySelectorAll(".js-vote-btn:checked").length;sum+=amount,0!==checkedEl&&"add"===action&&(sum++,amount++,counter.innerHTML=amount),0!==checkedEl&&"remove"===action&&(sum--,amount--,counter.innerHTML=amount)}})),Array.prototype.forEach.call(answers,(function(answer){var counter=answer.querySelector(".js-vote-count"),percent=answer.querySelector(".js-vote-percent"),amount=0;counter&&(amount=1*counter.textContent);var percentAge=Math.round(100*amount/sum);0!==sum?(counter&&(counter.innerHTML=amount),percent&&(percent.innerHTML=percentAge+"%")):(counter&&(counter.innerHTML=0),percent&&(percent.innerHTML="0%"))}))})),opts.voteEl&&t_triggerEvent(opts.voteEl,"tildavote:numberschanged")}function t_vote__incrementAnswerNum(voteID,answerId){var counter=document.querySelector('[data-vote-id="'+voteID+'"] [data-answer-id="'+answerId+'"] .js-vote-count');if(counter){var value=counter.textContent;counter.innerHTML=1*++value}}function t_vote__decrementAnswerNum(voteID,answerId){var counter=document.querySelector('[data-vote-id="'+voteID+'"] [data-answer-id="'+answerId+'"] .js-vote-count');if(counter){var value=counter.textContent;counter.innerHTML=1*--value}}function t_vote__setCookie(name,value,options){var expires=(options=options||{}).expires;if("number"==typeof expires&&expires){var date=new Date;date.setTime(date.getTime()+1e3*expires),expires=options.expires=date}expires&&expires.toUTCString&&(options.expires=expires.toUTCString());var updatedCookie=name+"="+(value=encodeURIComponent(value));for(var propName in options){updatedCookie+="; "+propName;var propValue=options[propName];!0!==propValue&&(updatedCookie+="="+propValue)}document.cookie=updatedCookie+"; SameSite=Lax;"}Array.prototype.some||(Array.prototype.some=function(fun){"use strict";if(null==this)throw new TypeError("Array.prototype.some called on null or undefined");if("function"!=typeof fun)throw new TypeError;for(var t=Object(this),len=t.length>>>0,thisArg=arguments.length>=2?arguments[1]:void 0,i=0;i<len;i++)if(i in t&&fun.call(thisArg,t[i],i,t))return!0;return!1}),function(e){var matches=e.matches||e.matchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector;e.matches=e.matchesSelector=matches||function matches(selector){var matches=document.querySelectorAll(selector),th=this;return Array.prototype.some.call(matches,(function(e){return e===th}))}}(Element.prototype),Element.prototype.closest||(Element.prototype.closest=function(s){for(var el=this;el&&1===el.nodeType;){if(Element.prototype.matches.call(el,s))return el;el=el.parentElement||el.parentNode}return null});